<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gerador de Criativos - Locu√ß√£o</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 980px;
            margin: 24px auto;
            padding: 0 16px;
        }

        .grid {
            display: grid;
            gap: 12px;
            grid-template-columns: 1fr 1fr;
        }

        label {
            font-weight: 700;
            font-size: 14px;
        }

        input,
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-sizing: border-box;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        button {
            padding: 12px 14px;
            border: 0;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
        }

        button:disabled {
            opacity: .6;
            cursor: not-allowed;
        }

        .row {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .card {
            border: 1px solid #e5e5e5;
            border-radius: 16px;
            padding: 14px;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #f7f7f7;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #eee;
            min-height: 80px;
        }

        .muted {
            opacity: .75;
            font-size: 13px;
            line-height: 1.4;
        }

        .full {
            grid-column: 1 / -1;
        }

        .actions {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: flex-end;
        }

        .status {
            font-size: 13px;
            opacity: .85;
        }

        .pill {
            font-size: 12px;
            border: 1px solid #e5e5e5;
            border-radius: 999px;
            padding: 6px 10px;
            background: #fafafa;
            cursor: pointer;
        }

        .pill:active {
            transform: scale(0.99);
        }

        @media (max-width: 720px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .actions {
                justify-content: stretch;
            }

            .actions button {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <h1>üéôÔ∏è Gerador de Criativos para Locu√ß√£o</h1>
    <p class="muted">Sem login. Sem cadastro. S√≥ funcional. (Usa proxy em <code>/api/gerar</code> na Vercel)</p>

    <div class="card">
        <!-- Presets r√°pidos (opcional, mas ajuda muito) -->
        <div class="row" style="margin-bottom:12px;">
            <button class="pill" type="button" id="presetImob">üè† Imobili√°ria</button>
            <button class="pill" type="button" id="presetLoja">üõí Loja</button>
            <button class="pill" type="button" id="presetClinica">üè• Cl√≠nica</button>
            <span class="muted">Dica: use os presets pra acelerar.</span>
        </div>

        <form id="form" class="grid">
            <div>
                <label>Tipo</label>
                <select id="tipo">
                    <option>Comercial</option>
                    <option>Institucional</option>
                    <option>Reels / Short</option>
                    <option>Carro de Som</option>
                    <option>Vinheta</option>
                    <option>Narra√ß√£o (v√≠deo)</option>
                </select>
            </div>

            <div>
                <label>Dura√ß√£o</label>
                <select id="duracao">
                    <option>15s</option>
                    <option selected>30s</option>
                    <option>40s</option>
                    <option>60s</option>
                </select>
            </div>

            <div>
                <label>Nicho/Cliente</label>
                <input id="nicho" placeholder="Ex: imobili√°ria, loja de constru√ß√£o, cl√≠nica..." />
            </div>

            <div>
                <label>Objetivo</label>
                <select id="objetivo">
                    <option>Vender</option>
                    <option>Gerar leads</option>
                    <option>Posicionamento/Autoridade</option>
                </select>
            </div>

            <div>
                <label>Tom de voz</label>
                <select id="tom">
                    <option>Premium (high-ticket)</option>
                    <option>Vendedor direto</option>
                    <option>Neutro profissional</option>
                    <option>Emocional</option>
                    <option>Engra√ßado</option>
                </select>
            </div>

            <div>
                <label>Regi√£o (opcional)</label>
                <input id="regiao" placeholder="Ex: Recife/PE" />
            </div>

            <!-- ‚úÖ NOVO: texto base -->
            <div class="full">
                <label>Seu texto base (opcional)</label>
                <textarea id="textoBase"
                    placeholder="Cole aqui um texto seu. Vou reescrever e elevar mantendo sua ideia."></textarea>
            </div>

            <div class="full">
                <label>Oferta / Diferencial / Informa√ß√µes obrigat√≥rias</label>
                <textarea id="oferta"
                    placeholder="Ex: Adquirindo 2 spots, o 3¬∫ √© gr√°tis. WhatsApp, endere√ßo, garantia, entrega..."></textarea>
            </div>

            <div class="full row">
                <div class="status" id="status">Preencha o briefing e clique em ‚ÄúGerar‚Äù.</div>
                <div class="actions" style="margin-left:auto;">
                    <button id="gerar" type="submit">Gerar</button>
                    <button id="copiar" type="button" disabled>Copiar</button>
                </div>
            </div>

            <div class="full muted">
                Dica: sua chave fica segura na Vercel em <strong>Environment Variables</strong>
                (<code>NANO_BANANA_API_KEY</code> ou <code>GEMINI_API_KEY</code>). Este site n√£o pede chave no
                navegador.
            </div>
        </form>
    </div>

    <div class="card" style="margin-top:14px;">
        <h3>Resultado</h3>
        <pre id="saida">Preencha o briefing e clique em ‚ÄúGerar‚Äù.</pre>
    </div>

    <script>
        const $ = (id) => document.getElementById(id);

        function montarPrompt() {
            const tipo = $("tipo").value;
            const duracao = $("duracao").value;
            const nicho = $("nicho").value.trim() || "N√ÉO INFORMADO";
            const objetivo = $("objetivo").value;
            const tom = $("tom").value;
            const regiao = $("regiao").value.trim();
            const textoBase = $("textoBase").value.trim();
            const oferta = $("oferta").value.trim() || "N√ÉO INFORMADO";

            return `
Voc√™ √© um redator publicit√°rio e diretor de cria√ß√£o especialista em LOCU√á√ÉO profissional de alto impacto.

Crie um roteiro ORIGINAL e pronto para ser narrado.
Se eu fornecer um "texto base", voc√™ deve:
- manter a IDEIA e a INTEN√á√ÉO
- reescrever para ficar mais premium e persuasivo
- eliminar clich√™s e frases gen√©ricas

Briefing:
- Tipo: ${tipo}
- Dura√ß√£o: ${duracao}
- Nicho/Cliente: ${nicho}
- Objetivo: ${objetivo}
- Tom de voz: ${tom}
- Regi√£o: ${regiao || "sem regi√£o"}
- Texto base: ${textoBase || "sem texto base"}
- Oferta/Diferencial/Info obrigat√≥ria: ${oferta}

Entregue obrigatoriamente:
1) Hook (0‚Äì3s) MUITO forte
2) Texto de locu√ß√£o com cad√™ncia (marque pausas com ‚Äú/‚Äù)
3) Palavras para √äNFASE em MAI√öSCULO
4) CTA claro (WhatsApp/DM/ligar/visitar)
5) 3 varia√ß√µes (√¢ngulos diferentes: benef√≠cio / prova / urg√™ncia)
6) Legenda pronta para Instagram + 12 hashtags (sem exagero, focadas no nicho)
7) Sugest√£o de visual do v√≠deo (cenas r√°pidas) para narrar por cima

Regras:
- Nada gen√©rico.
- Linguagem premium e direta.
- Sem clich√™s.
      `.trim();
        }

        function setLoading(isLoading) {
            $("gerar").disabled = isLoading;
            $("gerar").textContent = isLoading ? "Gerando..." : "Gerar";
        }

        async function gerar(e) {
            if (e) e.preventDefault();

            $("copiar").disabled = true;
            $("status").textContent = "Gerando...";
            $("saida").textContent = "Gerando...";
            setLoading(true);

            try {
                const prompt = montarPrompt();

                const res = await fetch("/api/gerar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ prompt }),
                });

                const data = await res.json().catch(() => ({}));

                if (!res.ok) {
                    const msg = data?.error || (await res.text().catch(() => "")) || "Erro desconhecido";
                    throw new Error(msg);
                }

                const out = (data && data.text) ? data.text : "";
                $("saida").textContent = out || "Sem texto retornado.";
                $("copiar").disabled = !out;
                $("status").textContent = out ? "Pronto ‚úÖ" : "Sem texto retornado.";

            } catch (e) {
                const msg = (e && e.message) ? e.message : String(e);
                $("saida").textContent = "Erro:\n" + msg;
                $("status").textContent = "Erro ao gerar ‚ùå";
            } finally {
                setLoading(false);
            }
        }

        async function copiar() {
            const text = $("saida").textContent || "";
            if (!text.trim()) return;

            try {
                await navigator.clipboard.writeText(text);
                $("status").textContent = "Copiado ‚úÖ";
                setTimeout(() => $("status").textContent = "Pronto ‚úÖ", 1200);
            } catch {
                $("status").textContent = "N√£o consegui copiar automaticamente. Selecione e copie.";
            }
        }

        // Presets
        function presetImobiliaria() {
            $("nicho").value = "Imobili√°ria (m√©dio/alto padr√£o)";
            $("objetivo").value = "Vender";
            $("tom").value = "Premium (high-ticket)";
            $("textoBase").value = "Seu novo im√≥vel te espera. Atendimento r√°pido e personalizado. Agende sua visita.";
        }

        function presetLoja() {
            $("nicho").value = "Loja (varejo)";
            $("objetivo").value = "Vender";
            $("tom").value = "Vendedor direto";
            $("textoBase").value = "Promo√ß√£o por tempo limitado. Chama no WhatsApp e garanta o seu hoje.";
        }

        function presetClinica() {
            $("nicho").value = "Cl√≠nica especializada";
            $("objetivo").value = "Gerar leads";
            $("tom").value = "Neutro profissional";
            $("textoBase").value = "Agende sua avalia√ß√£o. Atendimento humanizado e profissionais qualificados.";
        }

        $("form").addEventListener("submit", gerar);
        $("copiar").addEventListener("click", copiar);

        $("presetImob").addEventListener("click", presetImobiliaria);
        $("presetLoja").addEventListener("click", presetLoja);
        $("presetClinica").addEventListener("click", presetClinica);
    </script>
</body>

</html>